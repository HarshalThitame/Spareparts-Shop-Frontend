<app-navbar></app-navbar>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-2">
      <app-admin-sidebar></app-admin-sidebar>
    </div>
    <div class="col-md-9">
      <div class="container-fluid mt-5">
        <h6 class="mb-4 text-start">Manage Orders</h6>

        <div class="d-flex justify-content-between">
          <div class="input-group rounded search">
            <input
              type="search"
              class="form-control rounded"
              placeholder="Search Orders"
              aria-label="Search"
              aria-describedby="search-addon"
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()"
            />
            <span class="input-group-text border-0" id="search-addon">
              <i class="fas fa-search"></i>
            </span>
          </div>
        </div>

        <!-- Responsive and animated Material Table -->
        <div class="table-responsive">
          <table mat-table [dataSource]="filteredOrders" class="mat-elevation-z8">

            <!-- ID Column -->
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef class="text-center">ID</th>
              <td mat-cell *matCellDef="let order; let i = index" class="text-center">{{ i + 1 }}</td>
            </ng-container>

            <!-- Customer Type Column -->
            <ng-container matColumnDef="customerType">
              <th mat-header-cell *matHeaderCellDef class="text-center">Customer Type</th>
              <td mat-cell *matCellDef="let order" class="text-center">{{ order.user.userRole }}</td>
            </ng-container>

            <!-- Customer Name Column -->
            <ng-container matColumnDef="customerName">
              <th mat-header-cell *matHeaderCellDef class="text-center">Customer Name</th>
              <td mat-cell *matCellDef="let order" class="text-center">{{ order.user.firstName }} | {{ order.user.lastName }}</td>
            </ng-container>

            <!-- Order Date Column -->
            <ng-container matColumnDef="orderDate">
              <th mat-header-cell *matHeaderCellDef class="text-center">Order Date</th>
              <td mat-cell *matCellDef="let order" class="text-center">{{ order.createdAt | date: 'shortDate' }}</td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef class="text-center">Status</th>
              <td mat-cell *matCellDef="let order" class="text-center">{{ order.status }}</td>
            </ng-container>

            <!-- Order Items Column -->
            <ng-container matColumnDef="orderItems">
              <th mat-header-cell *matHeaderCellDef class="text-center">Order Items</th>
              <td mat-cell *matCellDef="let order" class="text-center">{{ order.orderItems.length }}</td>
            </ng-container>

            <!-- Total Amount Column -->
            <ng-container matColumnDef="totalAmount">
              <th mat-header-cell *matHeaderCellDef class="text-center">Total Amount</th>
              <td mat-cell *matCellDef="let order" class="text-center">{{ order.totalAmount | currency: 'INR' }}</td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef class="text-center">Actions</th>
              <td mat-cell *matCellDef="let order" class="text-center">
                <div class="d-flex justify-content-around m-0 p-0">
                  <a [routerLink]="['/admin/manage-orders/view-order-details', order.id]" mat-button color="primary">
                    <mat-icon>visibility</mat-icon> View
                  </a>
                  <a [routerLink]="['/admin/manage-orders/edit-order-details', order.id]" mat-button color="primary">
                    <mat-icon>edit</mat-icon> Edit
                  </a>
                  <button (click)="deleteOrder(order.id)" mat-button color="warn">
                    <mat-icon>delete</mat-icon> Delete
                  </button>
                </div>
              </td>
            </ng-container>

            <!-- Row Definition with Conditional Class -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumns;"
              [ngClass]="{ 'unviewed-order': !row.isViewed }"
              class="mat-row"
            ></tr>
          </table>

          <ng-template #noOrdersTemplate>
            <div class="text-center mt-5">
              <img [src]="NoImage" alt="No Orders" class="img-fluid" style="max-width: 300px;" />
              <h5 class="mt-3">No Orders Available</h5>
              <p>Please add some orders to get started.</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>
